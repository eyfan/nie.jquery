nie.util.bigUrs={data:[],create:function(){var a={};a.aHref="javascript:void(0);";a.tips={username:{txt:"\u60a8\u7684\u90ae\u7bb1\u5c06\u6210\u4e3a\u767b\u5f55\u5e10\u53f7","class":"inp-tips"}};a.progress={loadID:0,loadCap:0,chkUser:0,verCap:0,submit:0};a.domainReg=/^([\w-\.]+)@([\w-]+(?:\.[\w-]+){1,3})$/;a.regData={username:String,mailUrl:String,is163Mail:false};a.mail={"163.com":[2,1,1],"qq.com":[2,0,1],"vip.qq.com":[2,0,1],"gmail.com":[1,0,1],"hotmail.com":[1,0,1],"sina.com":[2,0,1],"sohu.com":[2,
0,1],"yahoo.com.cn":[2,0,1],"126.com":[2,1,0],"yeah.net":[2,1,0],"sina.cn":[2,0,0],"live.com":[2,0,0],"yahoo.cn":[2,0,0],"sogou.com":[2,0,0],"139.com":[1,0,0],"wo.com.cn":[2,0,0],"21cn.com":[2,0,0],"vip.163.com":[1,1,0],"vip.126.com":[1,1,0],"188.com":[2,1,0],"foxmail.com":[1,0,0]};a.sendMail=function(){var b=a.regData;b.is163Mail||a.get("sendActiveMail","userName="+b.username+"&promark="+a.promark,function(){var c=nie.util.bigUrs.data[a.dataID].sendMailResult;c&&c.status&&c.info&&alert(c.info)})};
a.r=function(){return(new Date).getTime()};a.server="http://weburs.ku.163.com/";a.serverPath=a.server+"quickReg/";a.get=function(b,c,h){$.include(a.serverPath+b+"?output=js&ver=3&dataID="+a.dataID+"&promark="+a.promark+"&"+c+"&"+a.r()+"&.js",h)};a.id="";a.dataID=nie.util.bigUrs.data.length;nie.util.bigUrs.data.push({});a.form=$(".NIE-quickReg");a.showCaptcha=false;a.result={};a.stats={regTime:false,monitor:false,log:false,pv:false,clickSugRegBtn:false,uvID:function(){var b=$.cookie("nie.util.bigUrs.uvID");
if(!b){b=a.r();$.cookie("nie.util.bigUrs.uvID",b,{expires:1,path:"/",domain:nie.config.site+".163.com"})}return b}()};a.$img=function(){var b=$(new Image);b.bind("readystatechange",function(){}).bind("abort",function(){});return b};a.runStats=function(b,c){if(a.stats[b]){var h=function(l,t){a.$img().attr("src",a.serverPath+"stats?3|"+a.stats.uvID+"|"+a.promark+"|"+l+"|"+(typeof t!="undefined"?t:0)+"|"+a.r())};switch(b){case "clickSugRegBtn":a.form.find(".sugRegBtn").click(function(){h("clickSugRegBtn")});
break;default:h(b,c)}}};a.promark="";a.capWidth=100;a.capHeight=32;a.msgID={msg:"NIE-quickReg-msg",title:"NIE-quickReg-msg-title",closeBtn:"NIE-quickReg-closeBtn",bg:"NIE-quickReg-msg-bg",con:"NIE-quickReg-msg-con"};a.msgSize={large:{w:490,h:270},small:{w:320,h:160},current:{}};a.msgO={msg:function(){return $("#"+a.msgID.msg)},title:function(){return $("#"+a.msgID.title)},closeBtn:function(){return $("#"+a.msgID.closeBtn)},bg:function(){return $("#"+a.msgID.bg)},con:function(){return $("#"+a.msgID.con)}};
a.fromSearch=false;a.engineInit=function(b){var c=false,h=0,l=1,t=[["^http://[^/]+.baidu.com/s?","wd",1],["^http[s]?://[^/]+.google.com(.hk)?/search","q",2],["^http://[^/]+.soso.com/q","w",1],["^http://[^/]+.(sogou|sogo).com/web","query",1],["^http://[^/]+.youdao.com/search","q",2],["^http://[^/]+.yahoo.com/(s?|search)","p",2],["^http://[^/]+.bing.com/search?","q",2]],v=nie.util.sEngine,e=v.cookie.info;if(v.isEngineRefer)c=true;else if(e.length>3&&e[0]>1){c=true;l=2;b=e[2];h=e[0]}if(c){c=0;for(v=
t.length;c<v;c++){e=t[c];if(RegExp(e[0],"i").test(b)){var u=document.createElement("a");u.href=b;u=u.search.match(RegExp("[&?]"+e[1]+"=([^&]+)","i"));if(u.length==2){e=e[2];switch(c){case 0:if(/[&\?]ie=utf-8/i.test(b))e=2;break;case 1:if(/[&\?]ie=(gbk|gb2312)/i.test(b))e=1;break;case 2:if(/[&\?]ie=utf-8/i.test(b))e=2;break;case 4:if(/[&\?]ue=(gbk|gb2312)/i.test(b))e=1;break;case 5:if(!/^http:\/\/one.cn.yahoo.com\//i.test(b))if(/[&\?]ei=(gbk|gb2312)/i.test(b))e=1}nie.util.bigUrs.data[a.dataID].engine=
{keyWord:encodeURIComponent(u[1]),encode:e,engineID:c+1,refer:encodeURIComponent(b),type:l,pages:h}}}}}};a.getUrl=function(){var b=nie.util.bigUrs.data[a.dataID].result.reDirectUrl;if(b!=null)b+=(b.indexOf("?")>0?"&":"?")+"username="+a.getVal("username");return b};a.getMsgHTML=function(){var b=a.regData;b="<div class='not163MailBox'><h1>\u611f\u8c22\u6ce8\u518c\uff01\u8bf7\u7acb\u5373\u6fc0\u6d3b\u5e10\u53f7\u3002</h1><h3>\u8bf7\u60a8\u767b\u5f55\u90ae\u7bb1 <b>"+b.username+"</b> \u6839\u636e\u786e\u8ba4\u90ae\u4ef6\u64cd\u4f5c\u5373\u53ef\u3002</h3>"+
(b.mailUrl?"<h2><a class='btn' href='"+b.mailUrl+"' target='_blank'>\u7acb\u5373\u67e5\u770b\u90ae\u4ef6</a></h2>":"<h2>\u8bf7\u7acb\u5373\u67e5\u6536\u786e\u8ba4\u90ae\u4ef6</h2>")+"<ul class='tips'><li>\u8fd8\u6ca1\u6709\u6536\u5230\u786e\u8ba4\u90ae\u4ef6\uff1f<ol><li>\u5c1d\u8bd5\u5230\u5e7f\u544a\u90ae\u4ef6\u3001\u5783\u573e\u90ae\u4ef6\u76ee\u5f55\u91cc\u627e\u627e\u770b\uff1b</li><li>\u518d\u6b21<a href='#' target='_self' class='sendMailBtn'>\u53d1\u9001\u6ce8\u518c\u786e\u8ba4\u90ae\u4ef6</a>\uff1b</li><li>\u5982\u679c\u91cd\u53d1\u6ce8\u518c\u786e\u8ba4\u90ae\u4ef6\u4f9d\u7136\u6ca1\u6709\u6536\u5230\uff0c\u8bf7<a class='reReg' target='_self' href='#'>\u91cd\u65b0\u6ce8\u518c</a>\u3002</li></ol></li></ul></div>";
$(".not163MailBox a.sendMailBtn").live("click",a.sendMail);$(".not163MailBox a.reReg").live("click",function(){window.location.reload()});return b};a.clearMsg=function(){a.msgO.con().empty()};a.showMsg=function(b){if(typeof b=="object"){var c=function(A){return typeof b[A]!="undefined"?b[A]:null},h=c("result"),l=c("url"),t=c("confirmFn"),v=c("username"),e=c("is163Mail");c("mailUrl");var u=c("msg");c=c("status");var y=$(window),z=y.width(),D=y.height(),C="_self";a.msgSize.current=!e&&h?a.msgSize.large:
a.msgSize.small;a.msgO.bg().length==0?$("<div>",{id:a.msgID.bg,css:{top:0,left:0,width:z,height:$(document).height()}}).appendTo($(document.body)):a.msgO.bg().show();if(a.msgO.msg().length==0){$("<div>",{id:a.msgID.msg,css:{top:(D-a.msgSize.current.h)/2+y.scrollTop(),left:(z-a.msgSize.current.w)/2+y.scrollLeft(),width:a.msgSize.current.w},html:'<div id="'+a.msgID.title+'">\u6ce8\u518c\u6e38\u620f\u5e10\u53f7</div><a id="'+a.msgID.closeBtn+'" href="'+a.aHref+'">X</a><div id="'+a.msgID.con+'"></div>'}).appendTo($(document.body));
a.msgO.closeBtn().live("click",function(){a.runStats("log",111);a.hideMsg()})}else a.clearMsg();a.msgO.msg().show();if(h&&l!=null){C="_blank";l+=(l.indexOf("?")>0?"&":"?")+"username="+v}else l=a.aHref;a.showCaptcha=false;if(h!=null)if(h&&!e&&c==202){a.msgO.con().html(a.getMsgHTML());$(".not163MailBox").attr("id","not163Mail")}else{h?a.msgO.con().addClass("right").html("<p class='info'>\u6ce8\u518c\u6210\u529f\uff01</p>"):a.msgO.con().addClass("error").html("<p class='info'>\u51fa\u9519\u4e86\uff01</p><p class='reason'>"+
u+"</p>");$("<a>",{href:l,target:C,text:"\u786e \u8ba4","class":"btn",click:function(){a.runStats("log",110);a.hideMsg();$.isFunction(t)&&t()}}).appendTo(a.msgO.con())}}};a.reBindEvt=function(b,c){b.unbind("blur").blur(c)};a.hideMsg=function(){a.msgO.bg().hide();a.msgO.msg().hide()};a.regComplete=a.showMsg;a.$=function(b){return a.form.find(b)};a.getO=function(b,c){var h=null;b=b.toLowerCase();if(c||!/^(password|repassword)$/.test(b))h=a.$((b=="idtype"?"select":"input")+"[name="+b+"]");return h};
a.getVal=function(b,c){var h=a.getO(b,c);return h!=null?$.trim(h.val()):null};a.init=function(){var b,c=a.$(".captcha-wrap"),h=0,l={username:{},password:{},repassword:{},promark:{},captcha:{}},t="",v="",e,u=true,y=function(d,i,j){var q=typeof d=="string"?a.getO(d,true):$(this),n=q.attr("name"),g=/^(password|repassword)$/.test(n)?q.val():$.trim(q.val()),s=a.$("label[for="+n+"]"),k=false;d=false;var o="",f="",w=function(){o=k?"right":"error";l[n].pass=k;var r=a.$("input[rel="+n+"]");if(k){q.show();
r.hide()}else{q.hide();r.show().val(f)}A(s,o,n);r.addClass(o)};s.removeClass("error right").addClass("loading");switch(n){case "username":var x=true,F=a.getVal("password",true),p=g.match(a.domainReg);if(g==""){f="\u5fc5\u586b";a.runStats("log",1)}else if(a.domainReg.test(g))if(g==F||p&&p[1]&&p[1]==F){f="\u4e0d\u80fd\u4e0e\u521b\u5efa\u5bc6\u7801\u76f8\u540c";a.runStats("log",8)}else if((p=g.match(a.domainReg))&&p.length==3&&a.mail[p[2]]&&a.mail[p[2]][1]==1){p=g.replace("@"+p[2],"");if(/^[a-z]/i.test(p))if(/[^a-z\d]$/i.test(p)){f=
"\u5b57\u6bcd\u6216\u6570\u5b57\u7ed3\u5c3e";a.runStats("log",4)}else if(/[^a-z\d_]/i.test(p)){f="\u5b57\u6bcd\u3001\u6570\u5b57\u3001\u4e0b\u5212\u7ebf";a.runStats("log",5)}else if(/^[a-z\d_]{6,18}$/i.test(p))x=false;else{f="6\uff5e18\u4e2a\u5b57\u7b26";a.runStats("log",6)}else{f="\u5fc5\u987b\u5b57\u6bcd\u5f00\u5934";a.runStats("log",3)}}else x=false;else{f="\u5fc5\u987b\u662f\u90ae\u7bb1\u5730\u5740";a.runStats("log",9)}if(!x&&(j||a.progress.chkUser==0)){a.progress.chkUser=1;d=true;a.get("checkUserName",
"userName="+g+"&promark="+a.promark+"&id="+a.id+"&val="+g,function(){a.progress.chkUser=0;var r=nie.util.bigUrs.data[a.dataID].checkUserName;switch(r.status){case 104:if(r.subStatus==0)k=true;else{f="\u8be5\u5e10\u53f7\u5df2\u6ce8\u518c\uff0c\u5f85\u6fc0\u6d3b\u4e2d\u3002";a.runStats("log",10)}break;case 200:f=r.info;a.runStats("log",12);break;default:f=r.info;a.runStats("log",11)}o=(l[n].pass=k)?"right":"error";r=a.$("input[rel="+n+"]");if(k){q.show();r.hide()}else{q.hide();r.show().val(f)}A(s,o,
n);r.addClass(o);$.isFunction(i)&&i();w()})}break;case "password":j=a.getVal("username",true);p=j.match(a.domainReg);if(g==""){f="\u5fc5\u586b";a.runStats("log",22)}else if(g==j||p&&p[1]&&g==p[1]){a.runStats("log",21);f="\u4e0d\u80fd\u4e0e\u5e38\u7528\u90ae\u7bb1\u76f8\u540c"}else if(/^[\S]{6,16}$/i.test(g)){k=true;j=a.getO("repassword",true);j.val()!=""&&j.triggerHandler("blur")}else{a.runStats("log",20);f="\u5fc5\u987b6\uff5e16\u4e2a\u5b57\u7b26"}break;case "repassword":if(g==a.getO("password",
true).val()&&g!="")k=true;else{a.runStats("log",30);f="\u4e0e\u521b\u5efa\u5bc6\u7801\u4e0d\u4e00\u81f4"}break;case "captcha":if(g==""){f="\u5fc5\u586b";a.runStats("log",71)}else if(g.length!=4){f="\u9a8c\u8bc1\u7801\u4e0d\u5339\u914d";a.runStats("log",72)}else if(j||a.progress.verCap==0){d=true;a.progress.verCap=1;a.get("Verifier","promark="+a.promark+"&id="+a.id+"&val="+g,function(){a.progress.verCap=0;switch(nie.util.bigUrs.data[a.dataID].verCapResult){case 0:k=true;break;case 1:f="\u9a8c\u8bc1\u7801\u4e0d\u5339\u914d";
z();a.runStats("log",70);break;case 2:f="\u5931\u8d25\u6b21\u6570\u591a\uff0c\u8bf7\u7a0d\u5019\u8f93\u5165";a.runStats("log",73)}o=(l[n].pass=k)?"right":"error";var r=a.$("input[rel="+n+"]");if(k){q.show();r.hide()}else{q.hide();r.show().val(f)}A(s,o,n);r.addClass(o);$.isFunction(i)&&i();w()})}}d||w()},z=function(){if(a.progress.loadCap==0){a.progress.loadCap=1;c.empty();a.$img().css({width:a.capWidth,height:a.capHeight}).click(function(){z();a.runStats("log",74)}).load(function(){a.progress.loadCap=
0;a.showCaptcha=true;c.append($(this))}).error(function(){c.removeClass("loading").text("\u540c\u4e00\u4e2aIP\u5237\u65b0\u8fc7\u591a")}).bind("readystatechange",function(){this.readyState=="complete"&&$(this).trigger("load").unbind("load")}).attr("src",a.serverPath+"Img?id="+a.id+"&"+a.r())}},D=function(d){if(a.progress.loadID==0){a.progress.loadID=1;h=a.r();a.get("IdCreator","promark="+a.promark,function(){a.progress.loadID=0;a.id=nie.util.bigUrs.data[a.dataID].id;a.$("#captchaBtn").attr({href:a.aHref,
target:"_self"}).click(function(){z();a.runStats("log",75)});a.showCaptcha||z();if(d&&$.isFunction(d.onComplete))d.onComplete()})}},C=function(d){if(!a.showCaptcha){b.fadeIn("fast");D({onComplete:function(){a.showCaptcha=true;a.runStats("log",0)}})}if(typeof d!="undefined"){d=$(this);var i=a.tips[d.attr("name")];i&&d.val()==i.txt&&d.val("").removeClass(i["class"])}},A=function(d,i){d.removeClass("loading "+(i=="right"?"error":"right")).addClass(i)};a.promark=a.getVal("promark");a.runStats("pv");a.runStats("clickSugRegBtn");
a.engineInit(document.referrer);if(typeof nie.util.bigUrs.data[a.dataID].engine!="undefined"){var B=nie.util.bigUrs.data[a.dataID].engine;a.get("fromSearch","type="+B.type+"&pages="+B.pages+"&keyWord="+B.keyWord+"&encode="+B.encode+"&engineID="+B.engineID+"&refer="+B.refer,function(){a.fromSearch=true})}$(".NIE-quickReg-loading").hide();a.form.show();b=a.$(".hideItem");e=a.$(".suggestDomain");for(var E in a.tips)a.getO(E,true).addClass(a.tips[E]["class"]).val(a.tips[E].txt);$.each(l,function(d){this.pass=
this.val=null;t+="input[name="+d+"],";v+="input[rel="+d+"],";a.$("label[for="+d+"]").html("<i class='loading'></i><i class='error'></i><i class='right'></i>")});t=t.substring(0,t.length-1);v=v.substring(0,v.length-1);a.form.attr("action","#").submit(function(){if(u)a.reBindEvt(a.getO("username",true),y);else return false;a.runStats("log",90);var d=0;l.promark.pass=a.promark!="";if(l.promark.pass)if(a.getO("agree").attr("checked")){var i=function(){d++;if(d==2){for(var j in l)if(!l[j].pass){a.getO(j,
true).triggerHandler("focus");return}a.runStats("log",100);var q=hasWating=false;setTimeout(function(){if(!q){hasWating=true;a.showMsg({msg:"\u63d0\u4ea4\u6570\u636e\u4e2d\uff0c\u8bf7\u7a0d\u540e...",url:null})}},3E3);var n=a.getVal("username",true);j="id="+a.id+"&username="+n+function(s){for(var k="",o=0,f=s.length;o<f;o++){var w=s[o],x=a.getO(w,true);x=x.length==0?"":x.val();if(/^(password|realname|idno|activityid1|activityid2)$/.test(w))x=encodeURIComponent(encodeURIComponent(x));k+="&"+w+"="+
x}return k}(["captcha","password","mobile","promark","activityid1","activityid2"]);if(a.fromSearch){var g=nie.util.bigUrs.data[a.dataID].engine;j+="&type="+g.type+"&pages="+g.pages+"&keyWord="+g.keyWord+"&encode="+g.encode+"&engineID="+g.engineID+"&refer="+g.refer}if(a.progress.submit==0){a.progress.submit=1;nie.util.bigUrs.data[a.dataID].result={};a.msgSize.current={};a.get("submit",j,function(){a.progress.submit=0;h!=0&&a.runStats("regTime",a.r()-h);h=0;q=true;a.hideMsg();a.regData={username:n,
is163Mail:false,mailUrl:null};var s=nie.util.bigUrs.data[a.dataID].result,k=parseInt(s.num),o=k==200||k==201||k==202;a.runStats("log",o?101:102);k==2&&z();if(hasWating){a.clearMsg();a.hideMsg()}var f=n.match(a.domainReg);if(f&&f.length==3&&a.mail[f[2]]){var w=a.mail[f[2]];if(w[1]==1){a.msgSize.current=a.msgSize.is163;a.regData.is163Mail=true}else a.msgSize.current=a.msgSize.not163;a.regData.mailUrl="http://"+(w[0]==1?"":"mail.")+f[2].toLowerCase()}if($.isFunction(a.regComplete)){a.regComplete({result:o,
status:k,msg:s.msg,url:s.reDirectUrl,data:s,username:n,is163Mail:a.regData.is163Mail,mailUrl:a.regData.mailUrl});a.runStats("monitor",1)}})}}};(function(){C();$.each(l,function(j){j!="promark"&&a.getO(j,true).triggerHandler("blur",[i,true])})})()}else alert("\u8bf7\u540c\u610f\u300a\u7f51\u6613\u670d\u52a1\u6761\u6b3e\u300b\u548c\u300a\u9690\u79c1\u6743\u4fdd\u62a4\u548c\u4e2a\u4eba\u4fe1\u606f\u5229\u7528\u653f\u7b56\u300b");else alert("\u6ce8\u518c\u5931\u8d25\uff0cpromark\u4e0d\u5b58\u5728")});
var m={exist:false,currentIndex:1,total:0,blur:function(){$("li.hover",e).triggerHandler("click");e.hide();u=true;y("username")},keyUp:function(d){d=d.which;if(d!=40&&d!=38&&d!=13){m.total=0;e.show().empty().html("<li class='title'>\u8bf7\u9009\u62e9\u90ae\u7bb1\u7c7b\u522b</li>");var i=$(this);d=i.val();var j=d.match(/^([\w-\.]+)[@]?/),q=[],n=function(k,o){$("<li>",{click:function(){i.val($(this).text());e.hide()},text:k}).hover(function(){var f=$(this);m.currentIndex=o;$("li",f.parent()).removeClass("hover");
f.addClass("hover")}).appendTo(e)};if(j){m.currentIndex=1;m.total=0;for(var g in a.mail)if(a.mail[g][2]==1)q.push(j[1]+"@"+g);else break;g=0;for(j=q.length;g<j;g++){var s=q[g];if(s.toLowerCase().indexOf(d.toLowerCase())==0){n(s,m.total);m.total++}}}if(m.total==0){u=true;m.exist=false;a.reBindEvt(i,m.blur);e.hide()}else{u=false;m.exist=true;i.triggerHandler("focus");a.reBindEvt(i,m.blur);$("li:eq(1)",e).addClass("hover")}}},keyDown:function(d){if(m.exist){var i=function(){$("li",e).removeClass("hover");
$("li:eq("+m.currentIndex+")",e).addClass("hover")};switch(d.which){case 40:m.currentIndex+1<=m.total&&m.currentIndex++;i();break;case 38:m.currentIndex!=1&&m.currentIndex--;i();break;case 13:if(e.css("display")=="block"){$(this);$("li.hover",e).triggerHandler("click");e.hide();u=false}else u=true}}}};a.$(v).focus(function(){var d=$(this),i=d.attr("rel");d.hide();a.getO(i,true).show().trigger("focus")});a.$(t).focus(C).blur(y);a.getO("username").keyup(m.keyUp).keydown(m.keyDown)};return a}};
