;(function(){"use strict";function Avt(settings){var settings={element:".NIE-avt",baseUrl:"http://game-active.webapp.163.com/app/active",hasMobile:true,gameid:""};var messages={"ArgErr":"\u53c2\u6570\u683c\u5f0f\u9519\u8bef","UrsUnEqual":"\u4e24\u6b21\u8f93\u5165\u7684\u901a\u884c\u8bc1\u4e0d\u4e00\u81f4","SysBusy":"\u7cfb\u7edf\u7e41\u5fd9\uff0c\u7a0d\u540e\u518d\u8bd5","NeedRegister":"\u5c1a\u672a\u6ce8\u518c\u901a\u884c\u8bc1","MobileUrs":"\u624b\u673a\u90ae\u7bb1\uff0c\u9700\u8981\u8f93\u5165\u4e3b\u8d26\u53f7","UnExistentCode":"\u6fc0\u6d3b\u7801\u4e0d\u5b58\u5728","UsedCode":"\u6fc0\u6d3b\u7801\u5df2\u7ecf\u88ab\u7528\u6389","AccountActivated":"\u8d26\u53f7\u5df2\u6fc0\u6d3b\u8fc7\uff0c\u65e0\u9700\u518d\u6b21\u6fc0\u6d3b","DuplicateMobile":"\u8be5\u624b\u673a\u53f7\u5df2\u7ecf\u6fc0\u6d3b\u8d26\u53f7\uff0c\u65e0\u6cd5\u518d\u6b21\u4f7f\u7528","Success":"\u6fc0\u6d3b\u6210\u529f"};var el=null;var mProgressingDialog=null;var mDialog=null;var inpValidateFunctions={"urs":function(data){if(data.urs==""){return result(false,"\u901a\u884c\u8bc1\u4e0d\u80fd\u4e3a\u7a7a")}if(/^([0-9A-Za-z_\-\.])+@([0-9A-Za-z_\-\.])+$/.test(data.urs)==false){return result(false,"\u901a\u884c\u8bc1\u683c\u5f0f\u9519\u8bef")}return result(true)},"urs_a":function(data){if(data.urs!=data.urs_a){return result(false,"\u901a\u884c\u8bc1\u8f93\u5165\u4e0d\u4e00\u81f4")}return result(true)},"activate_code":function(data){if(data.activate_code==""){return result(false,"\u6fc0\u6d3b\u7801\u4e0d\u80fd\u4e3a\u7a7a")}return result(true)},"mobile":function(data){if(data.mobile==""){return result(false,"\u624b\u673a\u53f7\u7801\u4e0d\u80fd\u4e3a\u7a7a")}if(/^1[0-9]{10}$/.test(data.mobile)==false){return result(false,"\u624b\u673a\u53f7\u7801\u683c\u5f0f\u9519\u8bef")}return result(true)}};function result(status,message){return{"status":status,"message":message}}function showResult(key,res){var thisElement=el.find("#"+key);thisElement.hide();thisElement.prev(".inp-res").addClass("inp-err").html(res.message).show()}function validate(data){var res=null,retVal=true;for(var key in data){if(inpValidateFunctions[key]){res=inpValidateFunctions[key](data);if(!res.status){showResult(key,res);retVal=retVal&&false}}}return retVal}function startProgressing(){if(mProgressingDialog==null){mProgressingDialog=new Avt.Dialog.create(el);mProgressingDialog.setContent(Avt.ProgressingBar)}mProgressingDialog.show()}function stopProgressing(){if(mProgressingDialog!=null){mProgressingDialog.hide()}}function onKeyup(e){}function onBlur(e){var ele=e.target;setTimeout(function(){var validateMap={};if(ele.id=="urs_a"){validateMap.urs=el.find("#urs").val()}validateMap[ele.id]=$(ele).val();validate(validateMap)},200)}function onChange(e){}function showDialog(res){if(mDialog==null){mDialog=new Avt.Dialog.create(el)}if(res.status){mDialog.setContent(new Avt.SuccessView());mDialog.show()}else{mDialog.setContent(new Avt.ErrorView(res.message));mDialog.show()}}function hideDialog(){if(mDialog!=null){mDialog.hide()}}function onSubmit(){if($.isFunction(settings.onSubmit)){if(!eval("("+settings.onSubmit.toString()+")();")){return }}var data={"urs":el.find("#urs").val(),"urs_a":el.find("#urs_a").val(),"activate_code":el.find("#activate_code").val(),"mobile":el.find("#mobile").val()};var valiResult=validate(data);if(!valiResult){return }startProgressing();$(this).attr("disabled","disabled");var url=settings.baseUrl+"?game={gameid}&urs={urs}&urs_a={urs_a}&activate_code={activate_code}&mobile={mobile}".replace("{gameid}",settings.gameid).replace("{urs}",data.urs).replace("{urs_a}",data.urs_a).replace("{activate_code}",data.activate_code).replace("{mobile}",data.mobile);$.ajax({url:url,dataType:"jsonp"})}function callback(msg,code){stopProgressing();el.find(settings.element+"-submit").removeAttr("disabled");if($.isFunction(settings.callback)){if(!eval("("+settings.callback.toString()+")(msg);")){return }}switch(code){case"Success":showDialog(result(true));break;case"UrsUnEqual":showResult("urs_a",result(false,msg));break;case"NeedRegister":case"MobileUrs":case"AccountActivated":showResult("urs",result(false,msg));break;case"UnExistentCode":case"UsedCode":showResult("activate_code",result(false,msg));break;case"DuplicateMobile":showResult("mobile",result(false,msg));break;case"SysBusy":case"ArgErr":default:showDialog(result(false,msg));break}}function onInput(e){$(e.target).hide();$(e.target).next(".inpTxt").show().focus()}this.onCreate=function(opts){$.extend(settings,opts);el=$(settings.element);el.find(".inpTxt").keyup(onKeyup).blur(onBlur);el.find(settings.element+"-submit").click(onSubmit);el.find(".inp-res").click(onInput).focus(function(e){$(e.target).next(".inpTxt").show().focus();$(e.target).hide()});window.func=callback}}Avt.create=function(opts){var mAvt=new Avt();mAvt.onCreate(opts);return mAvt};Avt.DialogView=function(){var proto=function(){this.el=null;this.getRootElement=function(){if($.isArray(this.el)){return this.el.get(0)||this.el[0]}return this.el};this.onCreate.apply(this,arguments)};return proto};Avt.DialogView.extend=function(o){var newProto=new Avt.DialogView();$.extend(newProto.prototype,o);return newProto};Avt.ProgressingBar="<div class=\"progressingbar\"></div>";Avt.SuccessView="<div class=\"successview\"></div>";Avt.ErrorView=Avt.DialogView.extend({onCreate:function(msg){var el=$("<div class=\"errorview\"><p>{msg}</p><p><a>\u8fd4\u56de</a></p></div>".replace("{msg}",msg));this.el=el;this.el.find("a").click(function(){el.parent().hide()})}});Avt.Dialog=function(){var id=0;var parent=null;var el=null;var html="<div class=\"dialog\" id=\"dialog-{id}\"></div>";this.onCreate=function(eParent){id=Avt.Dialog.id;parent=$(eParent);parent.append(html.replace("{id}",id));el=parent.find("#dialog-"+id)};this.getId=function(){return id};this.show=function(){el.show()};this.hide=function(){el.hide()};this.setContent=function(view){if(typeof view=="string"){el.html(view)}if(typeof view=="function"||typeof view=="object"){el.empty();el.append(view.getRootElement())}}};Avt.Dialog.id=0;Avt.Dialog.create=function(eParent){Avt.Dialog.id++;var mDialog=new Avt.Dialog();mDialog.onCreate(eParent);return mDialog};if(!nie){nie={}}if(!nie.util){nie.util={}}nie.util.Avt=Avt})(jQuery);
